<!DOCTYPE html>
<html lang="en" xmlns:th="https://www.thymeleaf.org">

<head>
    <div th:replace="fragments/libs :: libs"></div>
    <script src="/static/js/script.js"></script>
</head>

<body>
<div th:replace="fragments/header :: header">...</div>

<p id="dPS"></p>
<form th:action="@{/logout}" method="post">
    <input type="submit" value="Sign Out"/>
</form>

<script>
    function renderHabitItems() {
        $.getJSON('http://localhost:8080/get_habits', function (data) {
            let template = $("#items").html();
            let compiledTemplate = Handlebars.compile(template);
            let text = compiledTemplate({"habits": data});
            $("#dPS").html(text);
            $(".icon").click(function (event) {
                // tickHabit('{{id}}');
                if ($(event.currentTarget).hasClass("enabled")) {
                    $(event.currentTarget).removeClass("enabled");
                    $(event.currentTarget).addClass("disabled");
                } else {
                    $(event.currentTarget).removeClass("disabled");
                    $(event.currentTarget).addClass("enabled");
                }
            });
        })
    }

    function tickHabit(habit_id) {
        let url = "/today" + habit_id;
        let token = $("meta[name='_csrf']").attr("content");
        $.post(url, {_csrf: token});
    }

    $(function () {
        renderHabitItems();
    });

</script>

<script id="items" type="text/template">
    <dl>
        {{#habits}}
        <dt>
            {{#fori 0 perDay}}
            <div class="icon {{icon}} disabled"></div>
            {{/fori}}
        </dt>
        {{/habits}}
    </dl>
</script>

</body>
</html>